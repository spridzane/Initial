<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><link href="../../../../../doc/style.css?colorTheme=Custom.OdoTheme" rel="stylesheet" type="text/css" media="all"></head><body><html><body><p><a name="top"></a></p><table width="100%"><tr><td style="border: none; text-align: left;"></td><td style="border: none; text-align: right;"></td></tr></table><h1 id="HExtraexercise12:JavaNativeInterface"><span>Extra exercise 12: Java Native Interface</span></h1><ol><li><div><p>Review <span class="wikiinternallink"><a href="https://odo.lv/git/JTM/plain/doc/presentations/e12_JNI.odp">presentation</a></span></p><p>   <video src="https://odo.lv/ftp/lectures/Javae12.ogv" width="300" controls></body></html>
<a href="https://odo.lv/ftp/lectures/Javae12.ogv">Javae12.ogv</a></body></html>
</video></p></div></li></ol><ol><li>To add support for C development in Eclipse, install <strong>Eclipse CDT</strong> plugin, which you can search in Eclipse Marketplace by entering <strong>cdt</strong>.</li><li>Review content of <strong>jtm.extra12</strong> package and <strong>src/main/c/jnifunctions.c</strong> file.</li><li><div><p>Install GNU C compiler:</p><div class="box"><div class="code">sudo apt-get update<br>sudo apt-get install gcc</div></div></div></li><li>Implement TODO's for <strong>JNIClass.java</strong> class and <strong>jnifunctions.c</strong> file.</li><li><div><p>Compile <strong>JNIClass.java</strong> file considering classpath and target location:</p><div class="box"><div class="code">javac -cp target/classes -d target/classes src/main/java/jtm/extra12/JNIClass.java</div></div></div></li><li><div><p>Generate <strong>jtm_extra12_JNIClass.h</strong> file in lib folder:</p><div class="box"><div class="code">javah -cp target/classes -d lib/ jtm.extra12.JNIClass</div></div><p>This file will be located in <span class="wikimodel-verbatim">lib</span> folder of the project.</p></div></li><li>Check that list of methods is generated in <span class="wikimodel-verbatim">jtm_extra12_JNIClass.h</span> file.</li><li><div><p>Implement generated interfaces from <span class="wikimodel-verbatim">lib/jtm_extra12_JNIClass.h</span> file in <span class="wikimodel-verbatim">/src/main/c/jnifunctions.c</span> file:</p><div class="box"><div class="code">JNIEXPORT void JNICALL Java_jtm_extra12_JNIClass_printHello(JNIEnv * env, jclass class) {<br>	// TODO call printHello();<br>}<br><br>JNIEXPORT void JNICALL Java_jtm_extra12_JNIClass_printArray<br>(JNIEnv * env, jobject obj, jstring string) {<br>        // TODO #1: convert jstring to array of C chars<br>        // TODO #2: call printArray(yourarray);<br>        // TODO #3: release resourches for passed jstring<br>}<br><br>JNIEXPORT jstring JNICALL Java_jtm_extra12_JNIClass_createArray(JNIEnv * env,<br>		jobject obj, jint size) {<br>        // TODO #1: call createArray(size);<br>        // TODO #2: convert created array of C chars to jstring<br>        // TODO #3: return jstring<br>}</div></div></div></li><li><div><p>Compile <strong>jnifunctions.c</strong> file including JNI libraries for 64-bit Linux:</p><div class="box"><div class="code">gcc -fPIC -I/usr/lib/jvm/java-8-openjdk-amd64/include \<br>-I/usr/lib/jvm/java-8-openjdk-amd64/include/linux \<br>./src/main/c/jnifunctions.c -c -o ./lib/jnifunctions.o</div></div></div></li><li><div><p>Make shared library for Linux:</p><div class="box"><div class="code">gcc -shared ./lib/jnifunctions.o -o ./lib/jnifunctions.so</div></div></div></li><li><div><p>Test application by calling its main() method:</p><div class="box"><div class="code">java -cp target/classes/ jtm.extra12.JNIClass</div></div></div></li><li>Ensure <strong>JNIClassTest1.java</strong> unit tests are passing.</li></ol><h2 id="HOptionaltasks"><span>Optional tasks</span></h2><ol><li><div><p>You can compile jnifunctions.c as independent executable with following parameters:</p><div class="box"><div class="code">gcc -I/usr/lib/jvm/java-8-openjdk-amd64/include \<br>-I/usr/lib/jvm/java-8-openjdk-amd64/include/linux \<br>./src/main/c/jnifunctions.c -o ./lib/hello.o</div></div></div></li><li><div><p>Then execute created binary by:</p><div class="box"><div class="code">./lib/hello.o</div></div></div></li></ol><h2 id="HLinks"><span>Links</span></h2><ul><li><span class="wikiexternallink"><a href="https://docs.oracle.com/javase/7/docs/technotes/guides/jni/spec/jniTOC.html">Java Native Interface Specification</a></span></li><li><span class="wikiexternallink"><a href="https://docs.oracle.com/javase/7/docs/technotes/guides/jni/spec/functions.html">JNI Functions</a></span></li></ul><h2 id="HAlternatives"><span>Alternatives</span></h2><ul><li><span class="wikiexternallink"><a href="https://en.wikipedia.org/wiki/Java_Native_Access">Java Native Access (JNA)</a></span></li></ul><p><a name="top"></a></p><table width="100%"><tr><td width="40%" style="border: none; text-align: left;"></td><td width="20%" style="border: none; text-align: center;"><div><p><span class="wikilink"><a href="#top">Up</a></span> <br> <span class="wikilink"><a href="https://odo.lv/Training/JavaExerciseExtra">Home</a></span></p></div></td><td style="border: none; text-align: right;"></td></tr></table></body></html></body></html>